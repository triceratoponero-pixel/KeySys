--// WindUI Library
--// A modern, feature-rich UI library for Roblox
--// Supports PC & Mobile, draggable windows, and smooth animations

local UILibrary = {}
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

--// Configuration & Theming
local Theme = {
    Primary = Color3.fromRGB(88, 101, 242),      -- Discord Blurple
    Background = Color3.fromRGB(30, 30, 30),      -- Main background
    Secondary = Color3.fromRGB(40, 40, 40),       -- Secondary background
    Tertiary = Color3.fromRGB(50, 50, 50),        -- Input backgrounds
    Text = Color3.fromRGB(255, 255, 255),         -- Primary text
    TextDark = Color3.fromRGB(180, 180, 180),     -- Secondary text
    Border = Color3.fromRGB(60, 60, 60),          -- Borders
    Success = Color3.fromRGB(87, 242, 135),       -- Green
    Error = Color3.fromRGB(242, 87, 87),          -- Red
    Warning = Color3.fromRGB(242, 201, 87),       -- Yellow
    
    Font = Enum.Font.GothamSemibold,
    FontSize = 14,
    CornerRadius = UDim.new(0, 6),
    AnimationSpeed = TweenInfo.new(0.3, Enum.EasingStyle.Quart, Enum.EasingDirection.Out)
}

--// Utility Functions
local function Create(className, properties)
    local obj = Instance.new(className)
    for prop, val in pairs(properties or {}) do
        obj[prop] = val
    end
    return obj
end

local function Tween(obj, properties, duration, callback)
    local tween = TweenService:Create(obj, duration or Theme.AnimationSpeed, properties)
    if callback then tween.Completed:Connect(callback) end
    tween:Play()
    return tween
end

local function MakeDraggable(frame, handle)
    local dragging, dragInput, dragStart, startPos
    
    handle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    handle.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            dragInput = input
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            frame.Position = UDim2.new(
                startPos.X.Scale, startPos.X.Offset + delta.X,
                startPos.Y.Scale, startPos.Y.Offset + delta.Y
            )
        end
    end)
end

--// Notification System
local NotificationSystem = {}
NotificationSystem.Queue = {}
NotificationSystem.Active = false

function NotificationSystem:Init()
    if self.ScreenGui then return end
    
    self.ScreenGui = Create("ScreenGui", {
        Name = "WindUI_Notifications",
        Parent = PlayerGui,
        ZIndexBehavior = Enum.ZIndexBehavior.Global,
        ResetOnSpawn = false
    })
    
    self.Container = Create("Frame", {
        Name = "Container",
        Parent = self.ScreenGui,
        Size = UDim2.new(0, 300, 1, -20),
        Position = UDim2.new(1, -320, 0, 10),
        BackgroundTransparency = 1
    })
    
    self.Layout = Create("UIListLayout", {
        Parent = self.Container,
        Padding = UDim.new(0, 8),
        HorizontalAlignment = Enum.HorizontalAlignment.Right,
        VerticalAlignment = Enum.VerticalAlignment.Bottom,
        SortOrder = Enum.SortOrder.LayoutOrder
    })
end

function NotificationSystem:Notify(title, message, type, duration)
    self:Init()
    type = type or "Info"
    duration = duration or 3
    
    local colors = {
        Info = Theme.Primary,
        Success = Theme.Success,
        Error = Theme.Error,
        Warning = Theme.Warning
    }
    local color = colors[type] or Theme.Primary
    
    -- Create notification frame
    local notif = Create("Frame", {
        Name = "Notification",
        Parent = self.Container,
        Size = UDim2.new(0, 280, 0, 80),
        BackgroundColor3 = Theme.Secondary,
        BorderSizePixel = 0,
        LayoutOrder = #self.Container:GetChildren()
    })
    
    Create("UICorner", {CornerRadius = Theme.CornerRadius, Parent = notif})
    Create("UIStroke", {Color = Theme.Border, Thickness = 1, Parent = notif})
    
    local bar = Create("Frame", {
        Name = "Bar",
        Parent = notif,
        Size = UDim2.new(0, 4, 1, 0),
        BackgroundColor3 = color,
        BorderSizePixel = 0
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 2), Parent = bar})
    
    local titleLabel = Create("TextLabel", {
        Name = "Title",
        Parent = notif,
        Position = UDim2.new(0, 16, 0, 12),
        Size = UDim2.new(1, -32, 0, 20),
        BackgroundTransparency = 1,
        Text = title,
        TextColor3 = Theme.Text,
        Font = Theme.Font,
        TextSize = 16,
        TextXAlignment = Enum.TextXAlignment.Left,
        RichText = true
    })
    
    local msgLabel = Create("TextLabel", {
        Name = "Message",
        Parent = notif,
        Position = UDim2.new(0, 16, 0, 36),
        Size = UDim2.new(1, -32, 0, 40),
        BackgroundTransparency = 1,
        Text = message,
        TextColor3 = Theme.TextDark,
        Font = Enum.Font.Gotham,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextWrapped = true,
        RichText = true
    })
    
    local closeBtn = Create("TextButton", {
        Name = "Close",
        Parent = notif,
        Position = UDim2.new(1, -24, 0, 8),
        Size = UDim2.new(0, 16, 0, 16),
        BackgroundTransparency = 1,
        Text = "√ó",
        TextColor3 = Theme.TextDark,
        Font = Enum.Font.GothamBold,
        TextSize = 18
    })
    
    -- Animations
    notif.Position = UDim2.new(1, 0, 0, 0)
    Tween(notif, {Position = UDim2.new(0, 0, 0, 0)}, TweenInfo.new(0.4, Enum.EasingStyle.Back))
    
    local function close()
        Tween(notif, {Position = UDim2.new(1, 20, 0, 0)}, TweenInfo.new(0.3, Enum.EasingStyle.Quart), function()
            notif:Destroy()
        end)
    end
    
    closeBtn.MouseButton1Click:Connect(close)
    
    task.delay(duration, function()
        if notif.Parent then
            Tween(notif, {BackgroundTransparency = 1}, TweenInfo.new(0.3))
            Tween(titleLabel, {TextTransparency = 1}, TweenInfo.new(0.3))
            Tween(msgLabel, {TextTransparency = 1}, TweenInfo.new(0.3))
            Tween(bar, {BackgroundTransparency = 1}, TweenInfo.new(0.3), function()
                notif:Destroy()
            end)
        end
    end)
end

--// Tooltip System
local TooltipSystem = {
    CurrentTooltip = nil
}

function TooltipSystem:Show(text, parent)
    if self.CurrentTooltip then self.CurrentTooltip:Destroy() end
    
    local tooltip = Create("Frame", {
        Name = "Tooltip",
        Parent = PlayerGui,
        BackgroundColor3 = Theme.Tertiary,
        BorderSizePixel = 0,
        ZIndex = 100
    })
    
    Create("UICorner", {CornerRadius = UDim.new(0, 4), Parent = tooltip})
    Create("UIStroke", {Color = Theme.Border, Thickness = 1, Parent = tooltip})
    
    local label = Create("TextLabel", {
        Parent = tooltip,
        BackgroundTransparency = 1,
        Text = text,
        TextColor3 = Theme.Text,
        Font = Enum.Font.Gotham,
        TextSize = 12,
        Size = UDim2.new(0, 0, 0, 0),
        AutomaticSize = Enum.AutomaticSize.XY,
        Padding = UDim.new(0, 8)
    })
    
    Create("UIPadding", {
        Parent = tooltip,
        PaddingLeft = UDim.new(0, 8),
        PaddingRight = UDim.new(0, 8),
        PaddingTop = UDim.new(0, 4),
        PaddingBottom = UDim.new(0, 4)
    })
    
    self.CurrentTooltip = tooltip
    
    -- Position near mouse
    local connection
    connection = RunService.RenderStepped:Connect(function()
        if not tooltip.Parent then
            connection:Disconnect()
            return
        end
        local mouse = UserInputService:GetMouseLocation()
        tooltip.Position = UDim2.new(0, mouse.X + 15, 0, mouse.Y + 15)
    end)
end

function TooltipSystem:Hide()
    if self.CurrentTooltip then
        self.CurrentTooltip:Destroy()
        self.CurrentTooltip = nil
    end
end

--// Element Classes
local Element = {}
Element.__index = Element

function Element:AddTooltip(text)
    local frame = self.Instance
    frame.MouseEnter:Connect(function() TooltipSystem:Show(text, frame) end)
    frame.MouseLeave:Connect(function() TooltipSystem:Hide() end)
    return self
end

--// Button Class
local Button = setmetatable({}, Element)
Button.__index = Button

function Button.new(parent, text, callback)
    local self = setmetatable({}, Button)
    
    self.Instance = Create("TextButton", {
        Name = "Button",
        Parent = parent,
        Size = UDim2.new(1, 0, 0, 32),
        BackgroundColor3 = Theme.Tertiary,
        Text = "",
        AutoButtonColor = false
    })
    
    Create("UICorner", {CornerRadius = Theme.CornerRadius, Parent = self.Instance})
    Create("UIStroke", {Color = Theme.Border, Thickness = 1, Parent = self.Instance})
    
    local label = Create("TextLabel", {
        Parent = self.Instance,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Text = text,
        TextColor3 = Theme.Text,
        Font = Theme.Font,
        TextSize = Theme.FontSize
    })
    
    -- Hover effects
    self.Instance.MouseEnter:Connect(function()
        Tween(self.Instance, {BackgroundColor3 = Theme.Secondary})
    end)
    
    self.Instance.MouseLeave:Connect(function()
        Tween(self.Instance, {BackgroundColor3 = Theme.Tertiary})
    end)
    
    self.Instance.MouseButton1Click:Connect(function()
        Tween(self.Instance, {BackgroundColor3 = Theme.Primary}, TweenInfo.new(0.1), function()
            Tween(self.Instance, {BackgroundColor3 = Theme.Secondary})
        end)
        if callback then callback() end
    end)
    
    return self
end

--// Toggle Class
local Toggle = setmetatable({}, Element)
Toggle.__index = Toggle

function Toggle.new(parent, text, default, callback)
    local self = setmetatable({}, Toggle)
    self.Value = default or false
    self.Callback = callback
    
    self.Instance = Create("Frame", {
        Name = "Toggle",
        Parent = parent,
        Size = UDim2.new(1, 0, 0, 32),
        BackgroundTransparency = 1
    })
    
    local btn = Create("TextButton", {
        Name = "Button",
        Parent = self.Instance,
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = Theme.Tertiary,
        Text = "",
        AutoButtonColor = false
    })
    Create("UICorner", {CornerRadius = Theme.CornerRadius, Parent = btn})
    Create("UIStroke", {Color = Theme.Border, Thickness = 1, Parent = btn})
    
    local label = Create("TextLabel", {
        Parent = btn,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 12, 0, 0),
        Size = UDim2.new(1, -60, 1, 0),
        Text = text,
        TextColor3 = Theme.Text,
        Font = Theme.Font,
        TextSize = Theme.FontSize,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- Toggle background
    local switchBg = Create("Frame", {
        Parent = btn,
        Position = UDim2.new(1, -44, 0.5, -10),
        Size = UDim2.new(0, 36, 0, 20),
        BackgroundColor3 = self.Value and Theme.Primary or Theme.Border,
        BorderSizePixel = 0
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = switchBg})
    
    -- Toggle circle
    local circle = Create("Frame", {
        Parent = switchBg,
        Position = self.Value and UDim2.new(1, -18, 0, 2) or UDim2.new(0, 2, 0, 2),
        Size = UDim2.new(0, 16, 0, 16),
        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
        BorderSizePixel = 0
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = circle})
    
    function self:Set(value)
        self.Value = value
        Tween(switchBg, {BackgroundColor3 = value and Theme.Primary or Theme.Border})
        Tween(circle, {Position = value and UDim2.new(1, -18, 0, 2) or UDim2.new(0, 2, 0, 2)})
        if callback then callback(value) end
    end
    
    btn.MouseButton1Click:Connect(function()
        self:Set(not self.Value)
    end)
    
    btn.MouseEnter:Connect(function()
        Tween(btn, {BackgroundColor3 = Theme.Secondary})
    end)
    
    btn.MouseLeave:Connect(function()
        Tween(btn, {BackgroundColor3 = Theme.Tertiary})
    end)
    
    return self
end

--// Slider Class
local Slider = setmetatable({}, Element)
Slider.__index = Slider

function Slider.new(parent, text, min, max, default, callback, allowDecimals)
    local self = setmetatable({}, Slider)
    self.Min = min or 0
    self.Max = max or 100
    self.Value = default or self.Min
    self.Callback = callback
    self.AllowDecimals = allowDecimals or false
    
    self.Instance = Create("Frame", {
        Name = "Slider",
        Parent = parent,
        Size = UDim2.new(1, 0, 0, 50),
        BackgroundTransparency = 1
    })
    
    local label = Create("TextLabel", {
        Parent = self.Instance,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 0, 0, 0),
        Size = UDim2.new(1, -50, 0, 20),
        Text = text,
        TextColor3 = Theme.Text,
        Font = Theme.Font,
        TextSize = Theme.FontSize,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- Value textbox
    local valueBox = Create("TextBox", {
        Parent = self.Instance,
        Position = UDim2.new(1, -45, 0, 0),
        Size = UDim2.new(0, 45, 0, 20),
        BackgroundColor3 = Theme.Tertiary,
        Text = tostring(self.Value),
        TextColor3 = Theme.Text,
        Font = Theme.Font,
        TextSize = 12,
        ClearTextOnFocus = false
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 4), Parent = valueBox})
    Create("UIStroke", {Color = Theme.Border, Thickness = 1, Parent = valueBox})
    
    -- Slider track
    local track = Create("Frame", {
        Parent = self.Instance,
        Position = UDim2.new(0, 0, 0, 30),
        Size = UDim2.new(1, 0, 0, 6),
        BackgroundColor3 = Theme.Border,
        BorderSizePixel = 0
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = track})
    
    -- Fill
    local fill = Create("Frame", {
        Parent = track,
        Size = UDim2.new(0, 0, 1, 0),
        BackgroundColor3 = Theme.Primary,
        BorderSizePixel = 0
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = fill})
    
    -- Knob
    local knob = Create("Frame", {
        Parent = track,
        Position = UDim2.new(0, -6, 0.5, -6),
        Size = UDim2.new(0, 12, 0, 12),
        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
        BorderSizePixel = 0
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = knob})
    
    function self:Set(val)
        val = math.clamp(val, self.Min, self.Max)
        if not self.AllowDecimals then val = math.floor(val) end
        self.Value = val
        valueBox.Text = tostring(val)
        
        local percent = (val - self.Min) / (self.Max - self.Min)
        fill.Size = UDim2.new(percent, 0, 1, 0)
        knob.Position = UDim2.new(percent, -6, 0.5, -6)
        
        if callback then callback(val) end
    end
    
    -- Dragging logic
    local dragging = false
    
    local function update(input)
        local pos = math.clamp((input.Position.X - track.AbsolutePosition.X) / track.AbsoluteSize.X, 0, 1)
        local val = self.Min + (pos * (self.Max - self.Min))
        self:Set(val)
    end
    
    knob.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
        end
    end)
    
    track.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            update(input)
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            update(input)
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    
    valueBox.FocusLost:Connect(function()
        local num = tonumber(valueBox.Text)
        if num then
            self:Set(num)
        else
            valueBox.Text = tostring(self.Value)
        end
    end)
    
    self:Set(self.Value)
    return self
end

--// Dropdown Class
local Dropdown = setmetatable({}, Element)
Dropdown.__index = Dropdown

function Dropdown.new(parent, text, options, multiSelect, callback)
    local self = setmetatable({}, Dropdown)
    self.Options = options or {}
    self.MultiSelect = multiSelect or false
    self.Selected = multiSelect and {} or nil
    self.Callback = callback
    self.Open = false
    
    self.Instance = Create("Frame", {
        Name = "Dropdown",
        Parent = parent,
        Size = UDim2.new(1, 0, 0, 32),
        BackgroundTransparency = 1,
        ClipsDescendants = false
    })
    
    local btn = Create("TextButton", {
        Name = "Button",
        Parent = self.Instance,
        Size = UDim2.new(1, 0, 0, 32),
        BackgroundColor3 = Theme.Tertiary,
        Text = "",
        AutoButtonColor = false
    })
    Create("UICorner", {CornerRadius = Theme.CornerRadius, Parent = btn})
    Create("UIStroke", {Color = Theme.Border, Thickness = 1, Parent = btn})
    
    local label = Create("TextLabel", {
        Parent = btn,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 12, 0, 0),
        Size = UDim2.new(1, -40, 1, 0),
        Text = text .. ": " .. (multiSelect and "None" or "Select..."),
        TextColor3 = Theme.Text,
        Font = Theme.Font,
        TextSize = Theme.FontSize,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextTruncate = Enum.TextTruncate.AtEnd
    })
    
    local arrow = Create("TextLabel", {
        Parent = btn,
        Position = UDim2.new(1, -24, 0, 0),
        Size = UDim2.new(0, 20, 1, 0),
        BackgroundTransparency = 1,
        Text = "‚ñº",
        TextColor3 = Theme.TextDark,
        Font = Enum.Font.GothamBold,
        TextSize = 10
    })
    
    -- Dropdown frame
    self.DropFrame = Create("Frame", {
        Parent = self.Instance,
        Position = UDim2.new(0, 0, 0, 36),
        Size = UDim2.new(1, 0, 0, 0),
        BackgroundColor3 = Theme.Secondary,
        BorderSizePixel = 0,
        Visible = false,
        ZIndex = 10
    })
    Create("UICorner", {CornerRadius = Theme.CornerRadius, Parent = self.DropFrame})
    Create("UIStroke", {Color = Theme.Border, Thickness = 1, Parent = self.DropFrame})
    
    local scroll = Create("ScrollingFrame", {
        Parent = self.DropFrame,
        Size = UDim2.new(1, -4, 1, -4),
        Position = UDim2.new(0, 2, 0, 2),
        BackgroundTransparency = 1,
        ScrollBarThickness = 2,
        ScrollBarImageColor3 = Theme.Primary,
        CanvasSize = UDim2.new(0, 0, 0, 0)
    })
    
    local list = Create("UIListLayout", {
        Parent = scroll,
        Padding = UDim.new(0, 2),
        SortOrder = Enum.SortOrder.LayoutOrder
    })
    
    function self:Refresh(options)
        for _, child in pairs(scroll:GetChildren()) do
            if child:IsA("TextButton") then child:Destroy() end
        end
        
        for i, option in ipairs(options) do
            local optBtn = Create("TextButton", {
                Parent = scroll,
                Size = UDim2.new(1, 0, 0, 28),
                BackgroundColor3 = Theme.Tertiary,
                Text = "  " .. tostring(option) .. (self.MultiSelect and "" or ""),
                TextColor3 = Theme.Text,
                Font = Theme.Font,
                TextSize = 13,
                TextXAlignment = Enum.TextXAlignment.Left
            })
            Create("UICorner", {CornerRadius = UDim.new(0, 4), Parent = optBtn})
            
            if self.MultiSelect then
                local check = Create("Frame", {
                    Parent = optBtn,
                    Position = UDim2.new(1, -24, 0.5, -8),
                    Size = UDim2.new(0, 16, 0, 16),
                    BackgroundColor3 = self.Selected[option] and Theme.Primary or Theme.Border
                })
                Create("UICorner", {CornerRadius = UDim.new(0, 3), Parent = check})
                
                if self.Selected[option] then
                    local checkmark = Create("TextLabel", {
                        Parent = check,
                        Size = UDim2.new(1, 0, 1, 0),
                        BackgroundTransparency = 1,
                        Text = "‚úì",
                        TextColor3 = Color3.fromRGB(255, 255, 255),
                        Font = Enum.Font.GothamBold,
                        TextSize = 12
                    })
                end
            end
            
            optBtn.MouseButton1Click:Connect(function()
                if self.MultiSelect then
                    self.Selected[option] = not self.Selected[option]
                    -- Refresh visual
                    self:Refresh(options)
                    -- Update text
                    local selected = {}
                    for opt, sel in pairs(self.Selected) do if sel then table.insert(selected, opt) end end
                    label.Text = text .. ": " .. (#selected > 0 and table.concat(selected, ", ") or "None")
                    if callback then callback(self.Selected) end
                else
                    self.Selected = option
                    label.Text = text .. ": " .. tostring(option)
                    self:Toggle()
                    if callback then callback(option) end
                end
            end)
        end
        
        scroll.CanvasSize = UDim2.new(0, 0, 0, list.AbsoluteContentSize.Y)
    end
    
    function self:Toggle()
        self.Open = not self.Open
        self.DropFrame.Visible = true
        Tween(arrow, {Rotation = self.Open and 180 or 0})
        Tween(self.DropFrame, {Size = UDim2.new(1, 0, 0, self.Open and math.min(150, 32 * #self.Options + 4) or 0)})
        if not self.Open then
            task.delay(0.3, function() if not self.Open then self.DropFrame.Visible = false end end)
        end
    end
    
    btn.MouseButton1Click:Connect(function() self:Toggle() end)
    self:Refresh(self.Options)
    
    return self
end

--// Textbox Class
local Textbox = setmetatable({}, Element)
Textbox.__index = Textbox

function Textbox.new(parent, text, placeholder, callback, clearOnFocus)
    local self = setmetatable({}, Textbox)
    
    self.Instance = Create("Frame", {
        Name = "Textbox",
        Parent = parent,
        Size = UDim2.new(1, 0, 0, 50),
        BackgroundTransparency = 1
    })
    
    local label = Create("TextLabel", {
        Parent = self.Instance,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 0, 20),
        Text = text,
        TextColor3 = Theme.Text,
        Font = Theme.Font,
        TextSize = Theme.FontSize,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local box = Create("TextBox", {
        Parent = self.Instance,
        Position = UDim2.new(0, 0, 0, 22),
        Size = UDim2.new(1, 0, 0, 28),
        BackgroundColor3 = Theme.Tertiary,
        PlaceholderText = placeholder or "Enter text...",
        PlaceholderColor3 = Theme.TextDark,
        Text = "",
        TextColor3 = Theme.Text,
        Font = Theme.Font,
        TextSize = Theme.FontSize,
        ClearTextOnFocus = clearOnFocus or false
    })
    Create("UICorner", {CornerRadius = Theme.CornerRadius, Parent = box})
    Create("UIStroke", {Color = Theme.Border, Thickness = 1, Parent = box})
    
    box.Focused:Connect(function()
        Tween(box, {BackgroundColor3 = Theme.Secondary})
    end)
    
    box.FocusLost:Connect(function()
        Tween(box, {BackgroundColor3 = Theme.Tertiary})
        if callback then callback(box.Text) end
    end)
    
    self.GetText = function() return box.Text end
    self.SetText = function(txt) box.Text = txt end
    
    return self
end

--// Keybind Class
local Keybind = setmetatable({}, Element)
Keybind.__index = Keybind

function Keybind.new(parent, text, defaultKey, callback)
    local self = setmetatable({}, Keybind)
    self.Key = defaultKey
    self.Callback = callback
    self.Listening = false
    
    self.Instance = Create("Frame", {
        Name = "Keybind",
        Parent = parent,
        Size = UDim2.new(1, 0, 0, 32),
        BackgroundTransparency = 1
    })
    
    local label = Create("TextLabel", {
        Parent = self.Instance,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, -80, 1, 0),
        Text = text,
        TextColor3 = Theme.Text,
        Font = Theme.Font,
        TextSize = Theme.FontSize,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local btn = Create("TextButton", {
        Parent = self.Instance,
        Position = UDim2.new(1, -75, 0, 0),
        Size = UDim2.new(0, 75, 1, 0),
        BackgroundColor3 = Theme.Tertiary,
        Text = defaultKey and defaultKey.Name or "None",
        TextColor3 = Theme.Text,
        Font = Theme.Font,
        TextSize = 12,
        AutoButtonColor = false
    })
    Create("UICorner", {CornerRadius = Theme.CornerRadius, Parent = btn})
    Create("UIStroke", {Color = Theme.Border, Thickness = 1, Parent = btn})
    
    local function setListening(state)
        self.Listening = state
        btn.Text = state and "..." or (self.Key and self.Key.Name or "None")
        btn.BackgroundColor3 = state and Theme.Primary or Theme.Tertiary
    end
    
    btn.MouseButton1Click:Connect(function()
        setListening(not self.Listening)
    end)
    
    UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if self.Listening and not gameProcessed then
            if input.UserInputType == Enum.UserInputType.Keyboard then
                self.Key = input.KeyCode
                setListening(false)
                if callback then callback(self.Key) end
            end
        elseif self.Key and input.KeyCode == self.Key and not gameProcessed then
            if callback then callback(self.Key) end
        end
    end)
    
    return self
end

--// Search Bar Class
local SearchBar = setmetatable({}, Element)
SearchBar.__index = SearchBar

function SearchBar.new(parent, placeholder, searchList)
    local self = setmetatable({}, SearchBar)
    
    self.Instance = Create("Frame", {
        Name = "SearchBar",
        Parent = parent,
        Size = UDim2.new(1, 0, 0, 32),
        BackgroundTransparency = 1
    })
    
    local box = Create("TextBox", {
        Parent = self.Instance,
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = Theme.Tertiary,
        PlaceholderText = placeholder or "Search...",
        PlaceholderColor3 = Theme.TextDark,
        Text = "",
        TextColor3 = Theme.Text,
        Font = Theme.Font,
        TextSize = Theme.FontSize
    })
    Create("UICorner", {CornerRadius = Theme.CornerRadius, Parent = box})
    Create("UIStroke", {Color = Theme.Border, Thickness = 1, Parent = box})
    
    local icon = Create("TextLabel", {
        Parent = box,
        Position = UDim2.new(1, -28, 0, 0),
        Size = UDim2.new(0, 20, 1, 0),
        BackgroundTransparency = 1,
        Text = "üîç",
        TextColor3 = Theme.TextDark,
        Font = Enum.Font.Gotham,
        TextSize = 14
    })
    
    box:GetPropertyChangedSignal("Text"):Connect(function()
        local search = box.Text:lower()
        if searchList then
            for _, item in pairs(searchList:GetChildren()) do
                if item:IsA("Frame") or item:IsA("TextButton") then
                    local textLabel = item:FindFirstChildOfClass("TextLabel")
                    if textLabel then
                        local match = textLabel.Text:lower():find(search)
                        item.Visible = (search == "" or match ~= nil)
                    end
                end
            end
        end
    end)
    
    return self
end

--// Clipboard Button
local ClipboardButton = setmetatable({}, Element)
ClipboardButton.__index = ClipboardButton

function ClipboardButton.new(parent, textToCopy, buttonText)
    local self = setmetatable({}, ClipboardButton)
    
    self.Instance = Create("TextButton", {
        Name = "Clipboard",
        Parent = parent,
        Size = UDim2.new(1, 0, 0, 32),
        BackgroundColor3 = Theme.Tertiary,
        Text = buttonText or "Copy to Clipboard",
        TextColor3 = Theme.Text,
        Font = Theme.Font,
        TextSize = Theme.FontSize,
        AutoButtonColor = false
    })
    Create("UICorner", {CornerRadius = Theme.CornerRadius, Parent = self.Instance})
    Create("UIStroke", {Color = Theme.Border, Thickness = 1, Parent = self.Instance})
    
    self.Instance.MouseButton1Click:Connect(function()
        -- Try to use setclipboard (executor function) or fallback
        local success = pcall(function()
            return setclipboard(textToCopy)
        end)
        
        if success then
            NotificationSystem:Notify("Success", "Copied to clipboard!", "Success", 2)
        else
            -- Fallback: just notify with the text
            NotificationSystem:Notify("Copy", textToCopy:sub(1, 50) .. (#textToCopy > 50 and "..." or ""), "Info", 5)
        end
        
        Tween(self.Instance, {BackgroundColor3 = Theme.Success}, TweenInfo.new(0.2), function()
            Tween(self.Instance, {BackgroundColor3 = Theme.Tertiary})
        end)
    end)
    
    self.Instance.MouseEnter:Connect(function()
        Tween(self.Instance, {BackgroundColor3 = Theme.Secondary})
    end)
    
    self.Instance.MouseLeave:Connect(function()
        Tween(self.Instance, {BackgroundColor3 = Theme.Tertiary})
    end)
    
    return self
end

--// Paragraph/Label
local Paragraph = setmetatable({}, Element)
Paragraph.__index = Paragraph

function Paragraph.new(parent, text, bold)
    local self = setmetatable({}, Paragraph)
    
    self.Instance = Create("TextLabel", {
        Name = "Paragraph",
        Parent = parent,
        Size = UDim2.new(1, 0, 0, 0),
        BackgroundTransparency = 1,
        Text = text,
        TextColor3 = bold and Theme.Text or Theme.TextDark,
        Font = bold and Theme.Font or Enum.Font.Gotham,
        TextSize = bold and 14 or 13,
        TextWrapped = true,
        TextXAlignment = Enum.TextXAlignment.Left,
        AutomaticSize = Enum.AutomaticSize.Y
    })
    
    return self
end

--// Tab Class
local Tab = {}
Tab.__index = Tab

function Tab.new(name, icon, parent, contentParent)
    local self = setmetatable({}, Tab)
    self.Name = name
    
    -- Tab button (sidebar)
    self.Button = Create("TextButton", {
        Name = name .. "_Tab",
        Parent = parent,
        Size = UDim2.new(1, -8, 0, 32),
        BackgroundColor3 = Theme.Secondary,
        Text = icon and "" or name,
        TextColor3 = Theme.Text,
        Font = Theme.Font,
        TextSize = 14,
        AutoButtonColor = false
    })
    Create("UICorner", {CornerRadius = Theme.CornerRadius, Parent = self.Button})
    
    if icon then
        local iconLabel = Create("TextLabel", {
            Parent = self.Button,
            Size = UDim2.new(1, 0, 1, 0),
            BackgroundTransparency = 1,
            Text = icon,
            Font = Enum.Font.Gotham,
            TextSize = 20
        })
    end
    
    -- Content frame
    self.Content = Create("ScrollingFrame", {
        Name = name .. "_Content",
        Parent = contentParent,
        Size = UDim2.new(1, -16, 1, -16),
        Position = UDim2.new(0, 8, 0, 8),
        BackgroundTransparency = 1,
        ScrollBarThickness = 4,
        ScrollBarImageColor3 = Theme.Primary,
        Visible = false,
        CanvasSize = UDim2.new(0, 0, 0, 0)
    })
    
    self.Layout = Create("UIListLayout", {
        Parent = self.Content,
        Padding = UDim.new(0, 8),
        SortOrder = Enum.SortOrder.LayoutOrder
    })
    
    Create("UIPadding", {
        Parent = self.Content,
        PaddingLeft = UDim.new(0, 4),
        PaddingRight = UDim.new(0, 4)
    })
    
    -- Auto update canvas size
    self.Layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        self.Content.CanvasSize = UDim2.new(0, 0, 0, self.Layout.AbsoluteContentSize.Y + 16)
    end)
    
    return self
end

--// Window Class
local Window = {}
Window.__index = Window

function Window.new(title, size)
    local self = setmetatable({}, Window)
    self.Tabs = {}
    self.ActiveTab = nil
    
    -- Main GUI
    self.Gui = Create("ScreenGui", {
        Name = "WindUI_" .. HttpService:GenerateGUID(false),
        Parent = PlayerGui,
        ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
        ResetOnSpawn = false
    })
    
    -- Shadow
    local shadow = Create("ImageLabel", {
        Parent = self.Gui,
        Position = UDim2.new(0.5, -size.X.Offset/2 - 20, 0.5, -size.Y.Offset/2 - 20),
        Size = UDim2.new(0, size.X.Offset + 40, 0, size.Y.Offset + 40),
        BackgroundTransparency = 1,
        Image = "rbxassetid://6015897843",
        ImageColor3 = Color3.fromRGB(0, 0, 0),
        ImageTransparency = 0.5,
        SliceCenter = Rect.new(49, 49, 450, 450),
        ScaleType = Enum.ScaleType.Slice
    })
    
    -- Main Frame
    self.Main = Create("Frame", {
        Parent = self.Gui,
        Position = UDim2.new(0.5, -size.X.Offset/2, 0.5, -size.Y.Offset/2),
        Size = size,
        BackgroundColor3 = Theme.Background,
        BorderSizePixel = 0
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 8), Parent = self.Main})
    
    -- Top Bar
    local topBar = Create("Frame", {
        Parent = self.Main,
        Size = UDim2.new(1, 0, 0, 36),
        BackgroundColor3 = Theme.Secondary,
        BorderSizePixel = 0
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 8), Parent = topBar})
    
    -- Fix corner
    local cornerFix = Create("Frame", {
        Parent = topBar,
        Position = UDim2.new(0, 0, 1, -8),
        Size = UDim2.new(1, 0, 0, 8),
        BackgroundColor3 = Theme.Secondary,
        BorderSizePixel = 0
    })
    
    local titleLabel = Create("TextLabel", {
        Parent = topBar,
        Position = UDim2.new(0, 12, 0, 0),
        Size = UDim2.new(1, -100, 1, 0),
        BackgroundTransparency = 1,
        Text = title,
        TextColor3 = Theme.Text,
        Font = Enum.Font.GothamBold,
        TextSize = 16,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- Control buttons
    local minimizeBtn = Create("TextButton", {
        Parent = topBar,
        Position = UDim2.new(1, -64, 0, 8),
        Size = UDim2.new(0, 20, 0, 20),
        BackgroundColor3 = Theme.Warning,
        Text = "",
        AutoButtonColor = false
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = minimizeBtn})
    
    local closeBtn = Create("TextButton", {
        Parent = topBar,
        Position = UDim2.new(1, -32, 0, 8),
        Size = UDim2.new(0, 20, 0, 20),
        BackgroundColor3 = Theme.Error,
        Text = "",
        AutoButtonColor = false
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = closeBtn})
    
    -- Sidebar
    self.Sidebar = Create("Frame", {
        Parent = self.Main,
        Position = UDim2.new(0, 8, 0, 44),
        Size = UDim2.new(0, 140, 1, -52),
        BackgroundColor3 = Theme.Secondary,
        BorderSizePixel = 0
    })
    Create("UICorner", {CornerRadius = Theme.CornerRadius, Parent = self.Sidebar})
    
    local sidebarLayout = Create("UIListLayout", {
        Parent = self.Sidebar,
        Padding = UDim.new(0, 4),
        SortOrder = Enum.SortOrder.LayoutOrder
    })
    
    Create("UIPadding", {
        Parent = self.Sidebar,
        PaddingTop = UDim.new(0, 8),
        PaddingLeft = UDim.new(0, 4),
        PaddingRight = UDim.new(0, 4)
    })
    
    -- Content Area
    self.ContentArea = Create("Frame", {
        Parent = self.Main,
        Position = UDim2.new(0, 156, 0, 44),
        Size = UDim2.new(1, -164, 1, -52),
        BackgroundColor3 = Theme.Tertiary,
        BorderSizePixel = 0,
        ClipsDescendants = true
    })
    Create("UICorner", {CornerRadius = Theme.CornerRadius, Parent = self.ContentArea})
    
    -- Make draggable
    MakeDraggable(self.Main, topBar)
    MakeDraggable(shadow, topBar)
    
    -- Button functions
    local minimized = false
    minimizeBtn.MouseButton1Click:Connect(function()
        minimized = not minimized
        Tween(self.Main, {Size = minimized and UDim2.new(0, size.X.Offset, 0, 36) or size})
        Tween(shadow, {ImageTransparency = minimized and 1 or 0.5})
        self.Sidebar.Visible = not minimized
        self.ContentArea.Visible = not minimized
    end)
    
    closeBtn.MouseButton1Click:Connect(function()
        Tween(self.Main, {Position = UDim2.new(0.5, -size.X.Offset/2, 1, 0)}, TweenInfo.new(0.3), function()
            self.Gui:Destroy()
        end)
    end)
    
    return self
end

function Window:AddTab(name, icon)
    local tab = Tab.new(name, icon, self.Sidebar, self.ContentArea)
    table.insert(self.Tabs, tab)
    
    tab.Button.MouseButton1Click:Connect(function()
        self:SwitchTab(tab)
    end)
    
    if #self.Tabs == 1 then
        self:SwitchTab(tab)
    end
    
    return tab
end

function Window:SwitchTab(tab)
    if self.ActiveTab == tab then return end
    
    if self.ActiveTab then
        Tween(self.ActiveTab.Button, {BackgroundColor3 = Theme.Secondary})
        self.ActiveTab.Content.Visible = false
    end
    
    self.ActiveTab = tab
    Tween(tab.Button, {BackgroundColor3 = Theme.Primary})
    tab.Content.Visible = true
end

--// Element Addition Methods for Tab
function Tab:AddSection(text)
    local section = Create("TextLabel", {
        Parent = self.Content,
        Size = UDim2.new(1, 0, 0, 24),
        BackgroundTransparency = 1,
        Text = text,
        TextColor3 = Theme.Primary,
        Font = Enum.Font.GothamBold,
        TextSize = 12,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    return section
end

function Tab:AddButton(text, callback)
    return Button.new(self.Content, text, callback)
end

function Tab:AddToggle(text, default, callback)
    return Toggle.new(self.Content, text, default, callback)
end

function Tab:AddSlider(text, min, max, default, callback, decimals)
    return Slider.new(self.Content, text, min, max, default, callback, decimals)
end

function Tab:AddDropdown(text, options, multi, callback)
    return Dropdown.new(self.Content, text, options, multi, callback)
end

function Tab:AddTextbox(text, placeholder, callback, clearOnFocus)
    return Textbox.new(self.Content, text, placeholder, callback, clearOnFocus)
end

function Tab:AddKeybind(text, default, callback)
    return Keybind.new(self.Content, text, default, callback)
end

function Tab:AddSearch(placeholder)
    return SearchBar.new(self.Content, placeholder, self.Content)
end

function Tab:AddClipboard(textToCopy, buttonText)
    return ClipboardButton.new(self.Content, textToCopy, buttonText)
end

function Tab:AddParagraph(text, bold)
    return Paragraph.new(self.Content, text, bold)
end

--// Public API
function UILibrary:CreateWindow(title, size)
    return Window.new(title, size or UDim2.new(0, 600, 0, 400))
end

function UILibrary:Notify(title, message, type, duration)
    NotificationSystem:Notify(title, message, type, duration)
end

--// Demo / Example Usage
--[[
local Window = UILibrary:CreateWindow("WindUI Demo", UDim2.new(0, 650, 0, 450))

-- Combat Tab
local Combat = Window:AddTab("Combat", "‚öîÔ∏è")
Combat:AddSection("Main Features")

local aimbotToggle = Combat:AddToggle("Aimbot", false, function(state)
    print("Aimbot:", state)
end):AddTooltip("Automatically aims at enemies")

Combat:AddSlider("FOV", 0, 360, 90, function(val)
    print("FOV:", val)
end)

Combat:AddDropdown("Target Part", {"Head", "Torso", "Legs"}, false, function(selection)
    print("Targeting:", selection)
end)

-- Movement Tab
local Movement = Window:AddTab("Movement", "üèÉ")
Movement:AddSection("Speed")

Movement:AddToggle("Speed Hack", false)
Movement:AddSlider("Speed Multiplier", 1, 10, 2)

-- Settings Tab
local Settings = Window:AddTab("Settings", "‚öôÔ∏è")
Settings:AddSection("Configuration")

Settings:AddKeybind("Panic Key", Enum.KeyCode.Delete, function()
    UILibrary:Notify("System", "Panic key pressed!", "Warning")
end)

Settings:AddTextbox("Config Name", "Enter name...", function(text)
    print("Config:", text)
end)

Settings:AddClipboard("https://discord.gg/example", "Copy Discord Link")

Settings:AddParagraph("This is a description of how to use the library. It supports word wrap and long text explanations.", false)

Settings:AddSearch("Filter settings...")

-- Notification test
task.wait(1)
UILibrary:Notify("Welcome", "WindUI Library loaded successfully!", "Success", 3)
]]

return UILibrary
