--// WindUI Library v2.1 - Fixed ColorSequence
--// Features: Animated backgrounds, glassmorphism, particles, smooth transitions

local UILibrary = {}
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local HttpService = game:GetService("HttpService")
local RunService = game:GetService("RunService")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

--// Enhanced Theme System
local Theme = {
    Primary = Color3.fromRGB(88, 101, 242),
    SecondaryColor = Color3.fromRGB(156, 136, 255), -- For gradients
    Background = Color3.fromRGB(20, 20, 25),
    Secondary = Color3.fromRGB(30, 30, 35),
    Tertiary = Color3.fromRGB(40, 40, 50),
    Surface = Color3.fromRGB(45, 45, 60),
    Text = Color3.fromRGB(255, 255, 255),
    TextDark = Color3.fromRGB(180, 180, 200),
    Border = Color3.fromRGB(60, 60, 80),
    Glow = Color3.fromRGB(88, 101, 242),
    
    CornerRadius = UDim.new(0, 8),
    AnimationSpeed = TweenInfo.new(0.35, Enum.EasingStyle.Quart, Enum.EasingDirection.Out),
    SpringSpeed = TweenInfo.new(0.5, Enum.EasingStyle.Elastic, Enum.EasingDirection.Out),
    GlassTransparency = 0.15,
    
    Font = Enum.Font.GothamSemibold,
    FontSize = 14
}

--// Utility Functions
local function Create(className, properties)
    local obj = Instance.new(className)
    for prop, val in pairs(properties or {}) do
        obj[prop] = val
    end
    return obj
end

local function Tween(obj, properties, info, callback)
    local tween = TweenService:Create(obj, info or Theme.AnimationSpeed, properties)
    if callback then tween.Completed:Connect(callback) end
    tween:Play()
    return tween
end

local function MakeDraggable(frame, handle)
    local dragging, dragStart, startPos
    
    handle.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = frame.Position
            
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)
    
    handle.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
            if dragging then
                local delta = input.Position - dragStart
                frame.Position = UDim2.new(
                    startPos.X.Scale, startPos.X.Offset + delta.X,
                    startPos.Y.Scale, startPos.Y.Offset + delta.Y
                )
            end
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
end

--// Particle Background System
local ParticleSystem = {}
function ParticleSystem:Init(parent)
    if self.Active then return end
    self.Active = true
    
    local container = Create("Frame", {
        Name = "Particles",
        Parent = parent,
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundTransparency = 1,
        ZIndex = 0
    })
    
    local particles = {}
    
    for i = 1, 15 do
        local particle = Create("ImageLabel", {
            Parent = container,
            Size = UDim2.new(0, math.random(4, 8), 0, math.random(4, 8)),
            Position = UDim2.new(math.random(), 0, math.random(), 0),
            BackgroundTransparency = 1,
            Image = "rbxassetid://6764432408",
            ImageColor3 = Theme.Primary,
            ImageTransparency = math.random(5, 8) / 10,
            ZIndex = 0
        })
        
        table.insert(particles, {
            obj = particle,
            speed = math.random(10, 30) / 100,
            offset = math.random() * 10
        })
    end
    
    spawn(function()
        while container and container.Parent do
            for _, p in pairs(particles) do
                if not p.obj.Parent then continue end
                p.offset = p.offset + p.speed * 0.1
                local x = math.sin(p.offset) * 0.002
                local y = math.cos(p.offset) * 0.002
                
                local newPos = p.obj.Position + UDim2.new(x, 0, y, 0)
                
                -- Wrap around
                if newPos.X.Scale < 0 then newPos = UDim2.new(1, 0, newPos.Y.Scale, 0) end
                if newPos.X.Scale > 1 then newPos = UDim2.new(0, 0, newPos.Y.Scale, 0) end
                if newPos.Y.Scale < 0 then newPos = UDim2.new(newPos.X.Scale, 0, 1, 0) end
                if newPos.Y.Scale > 1 then newPos = UDim2.new(newPos.X.Scale, 0, 0, 0) end
                
                p.obj.Position = newPos
            end
            task.wait(0.05)
        end
    end)
end

--// Animated Gradient Background - FIXED VERSION
local GradientSystem = {}
function GradientSystem:Apply(frame)
    -- Use two-color constructor instead of table
    local gradient = Create("UIGradient", {
        Parent = frame,
        Color = ColorSequence.new(Theme.Primary, Theme.SecondaryColor), -- Fixed: two Color3 values
        Rotation = 0,
        Transparency = NumberSequence.new(0.95, 0.95)
    })
    
    spawn(function()
        local rotation = 0
        while frame and frame.Parent do
            rotation = rotation + 0.5
            if rotation > 360 then rotation = 0 end
            gradient.Rotation = rotation
            task.wait(0.05)
        end
    end)
    
    return gradient
end

--// Notification System
local NotificationSystem = {}
function NotificationSystem:Init()
    if self.ScreenGui then return end
    
    self.ScreenGui = Create("ScreenGui", {
        Name = "WindUI_Notifications",
        Parent = PlayerGui,
        ZIndexBehavior = Enum.ZIndexBehavior.Global,
        ResetOnSpawn = false
    })
    
    self.Container = Create("Frame", {
        Parent = self.ScreenGui,
        Size = UDim2.new(0, 320, 1, -40),
        Position = UDim2.new(1, -340, 0, 20),
        BackgroundTransparency = 1
    })
    
    self.Layout = Create("UIListLayout", {
        Parent = self.Container,
        Padding = UDim.new(0, 10),
        HorizontalAlignment = Enum.HorizontalAlignment.Right,
        VerticalAlignment = Enum.VerticalAlignment.Bottom
    })
end

function NotificationSystem:Notify(title, message, type, duration)
    self:Init()
    type = type or "Info"
    duration = duration or 3
    
    local colors = {
        Info = Theme.Primary, 
        Success = Color3.fromRGB(87, 242, 135), 
        Error = Color3.fromRGB(242, 87, 87), 
        Warning = Color3.fromRGB(242, 201, 87)
    }
    local color = colors[type] or Theme.Primary
    
    local notif = Create("Frame", {
        Parent = self.Container,
        Size = UDim2.new(0, 300, 0, 0),
        BackgroundColor3 = Theme.Secondary,
        BorderSizePixel = 0,
        ClipsDescendants = true
    })
    Create("UICorner", {CornerRadius = Theme.CornerRadius, Parent = notif})
    
    -- Glow effect
    local glow = Create("ImageLabel", {
        Parent = notif,
        Size = UDim2.new(1, 20, 1, 20),
        Position = UDim2.new(0, -10, 0, -10),
        BackgroundTransparency = 1,
        Image = "rbxassetid://6015897843",
        ImageColor3 = color,
        ImageTransparency = 0.8,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(49, 49, 450, 450)
    })
    
    local bar = Create("Frame", {
        Parent = notif,
        Size = UDim2.new(0, 3, 1, 0),
        BackgroundColor3 = color,
        BorderSizePixel = 0
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 2), Parent = bar})
    
    local titleLabel = Create("TextLabel", {
        Parent = notif,
        Position = UDim2.new(0, 16, 0, 12),
        Size = UDim2.new(1, -40, 0, 22),
        BackgroundTransparency = 1,
        Text = title,
        TextColor3 = Theme.Text,
        Font = Enum.Font.GothamBold,
        TextSize = 16,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local msgLabel = Create("TextLabel", {
        Parent = notif,
        Position = UDim2.new(0, 16, 0, 38),
        Size = UDim2.new(1, -32, 0, 40),
        BackgroundTransparency = 1,
        Text = message,
        TextColor3 = Theme.TextDark,
        Font = Enum.Font.Gotham,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left,
        TextWrapped = true
    })
    
    Tween(notif, {Size = UDim2.new(0, 300, 0, 85)}, Theme.SpringSpeed)
    
    local progress = Create("Frame", {
        Parent = notif,
        Position = UDim2.new(0, 0, 1, -2),
        Size = UDim2.new(1, 0, 0, 2),
        BackgroundColor3 = color,
        BorderSizePixel = 0
    })
    
    Tween(progress, {Size = UDim2.new(0, 0, 0, 2)}, TweenInfo.new(duration, Enum.EasingStyle.Linear))
    
    task.delay(duration, function()
        if notif.Parent then
            Tween(notif, {Size = UDim2.new(0, 300, 0, 0)}, Theme.AnimationSpeed, function()
                notif:Destroy()
            end)
        end
    end)
end

--// Tooltip System
local TooltipSystem = {}
function TooltipSystem:Show(text)
    if self.Current then self.Current:Destroy() end
    
    local mouse = UserInputService:GetMouseLocation()
    
    self.Current = Create("Frame", {
        Parent = PlayerGui,
        Position = UDim2.new(0, mouse.X + 15, 0, mouse.Y + 15),
        Size = UDim2.new(0, 0, 0, 0),
        BackgroundColor3 = Theme.Surface,
        BorderSizePixel = 0,
        ZIndex = 100
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 6), Parent = self.Current})
    
    local label = Create("TextLabel", {
        Parent = self.Current,
        BackgroundTransparency = 1,
        Text = text,
        TextColor3 = Theme.Text,
        Font = Enum.Font.Gotham,
        TextSize = 12,
        AutomaticSize = Enum.AutomaticSize.XY,
        Size = UDim2.new(0, 0, 0, 0)
    })
    
    Create("UIPadding", {
        Parent = self.Current,
        PaddingLeft = UDim.new(0, 10),
        PaddingRight = UDim.new(0, 10),
        PaddingTop = UDim.new(0, 6),
        PaddingBottom = UDim.new(0, 6)
    })
    
    Tween(self.Current, {Size = UDim2.new(0, label.AbsoluteSize.X + 20, 0, label.AbsoluteSize.Y + 12)}, TweenInfo.new(0.2))
end

function TooltipSystem:Hide()
    if self.Current then
        Tween(self.Current, {Size = UDim2.new(0, 0, 0, 0)}, TweenInfo.new(0.2), function()
            if self.Current then self.Current:Destroy() end
        end)
    end
end

--// Element Classes
local Element = {}
Element.__index = Element

function Element:AddTooltip(text)
    self.Instance.MouseEnter:Connect(function() TooltipSystem:Show(text) end)
    self.Instance.MouseLeave:Connect(function() TooltipSystem:Hide() end)
    return self
end

--// Button with Glow Effect
local Button = setmetatable({}, Element)
Button.__index = Button

function Button.new(parent, text, callback)
    local self = setmetatable({}, Button)
    
    self.Instance = Create("TextButton", {
        Parent = parent,
        Size = UDim2.new(1, 0, 0, 36),
        BackgroundColor3 = Theme.Tertiary,
        Text = "",
        AutoButtonColor = false,
        ClipsDescendants = true
    })
    Create("UICorner", {CornerRadius = Theme.CornerRadius, Parent = self.Instance})
    
    local glow = Create("Frame", {
        Parent = self.Instance,
        Position = UDim2.new(0, 0, 1, -2),
        Size = UDim2.new(0, 0, 0, 2),
        BackgroundColor3 = Theme.Primary,
        BorderSizePixel = 0
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 1), Parent = glow})
    
    local label = Create("TextLabel", {
        Parent = self.Instance,
        BackgroundTransparency = 1,
        Size = UDim2.new(1, 0, 1, 0),
        Text = text,
        TextColor3 = Theme.Text,
        Font = Theme.Font,
        TextSize = Theme.FontSize
    })
    
    self.Instance.MouseEnter:Connect(function()
        Tween(self.Instance, {BackgroundColor3 = Theme.Surface})
        Tween(glow, {Size = UDim2.new(1, 0, 0, 2)})
        label.TextColor3 = Theme.Primary
    end)
    
    self.Instance.MouseLeave:Connect(function()
        Tween(self.Instance, {BackgroundColor3 = Theme.Tertiary})
        Tween(glow, {Size = UDim2.new(0, 0, 0, 2)})
        label.TextColor3 = Theme.Text
    end)
    
    self.Instance.MouseButton1Down:Connect(function()
        Tween(self.Instance, {Size = UDim2.new(0.98, 0, 0, 36)}, TweenInfo.new(0.1))
    end)
    
    self.Instance.MouseButton1Up:Connect(function()
        Tween(self.Instance, {Size = UDim2.new(1, 0, 0, 36)}, Theme.SpringSpeed)
        if callback then callback() end
    end)
    
    return self
end

--// Toggle with Animation
local Toggle = setmetatable({}, Element)
Toggle.__index = Toggle

function Toggle.new(parent, text, default, callback)
    local self = setmetatable({}, Toggle)
    self.Value = default or false
    self.Callback = callback
    
    self.Instance = Create("Frame", {
        Parent = parent,
        Size = UDim2.new(1, 0, 0, 36),
        BackgroundTransparency = 1
    })
    
    local btn = Create("TextButton", {
        Parent = self.Instance,
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = self.Value and Theme.Primary or Theme.Tertiary,
        Text = "",
        AutoButtonColor = false
    })
    Create("UICorner", {CornerRadius = Theme.CornerRadius, Parent = btn})
    
    local label = Create("TextLabel", {
        Parent = btn,
        BackgroundTransparency = 1,
        Position = UDim2.new(0, 12, 0, 0),
        Size = UDim2.new(1, -70, 1, 0),
        Text = text,
        TextColor3 = self.Value and Color3.fromRGB(255,255,255) or Theme.Text,
        Font = Theme.Font,
        TextSize = Theme.FontSize,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local switchBg = Create("Frame", {
        Parent = btn,
        Position = UDim2.new(1, -50, 0.5, -12),
        Size = UDim2.new(0, 40, 0, 24),
        BackgroundColor3 = self.Value and Color3.fromRGB(255,255,255) or Color3.fromRGB(80, 80, 90),
        BorderSizePixel = 0
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = switchBg})
    
    local circle = Create("Frame", {
        Parent = switchBg,
        Position = self.Value and UDim2.new(1, -20, 0, 2) or UDim2.new(0, 2, 0, 2),
        Size = UDim2.new(0, 20, 0, 20),
        BackgroundColor3 = self.Value and Theme.Primary or Color3.fromRGB(200, 200, 200),
        BorderSizePixel = 0
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = circle})
    
    function self:Set(value)
        self.Value = value
        Tween(btn, {BackgroundColor3 = value and Theme.Primary or Theme.Tertiary})
        Tween(label, {TextColor3 = value and Color3.fromRGB(255,255,255) or Theme.Text})
        Tween(switchBg, {BackgroundColor3 = value and Color3.fromRGB(255,255,255) or Color3.fromRGB(80, 80, 90)})
        Tween(circle, {Position = value and UDim2.new(1, -20, 0, 2) or UDim2.new(0, 2, 0, 2), BackgroundColor3 = value and Theme.Primary or Color3.fromRGB(200, 200, 200)})
        if callback then callback(value) end
    end
    
    btn.MouseButton1Click:Connect(function() self:Set(not self.Value) end)
    
    btn.MouseEnter:Connect(function()
        if not self.Value then Tween(btn, {BackgroundColor3 = Theme.Surface}) end
    end)
    
    btn.MouseLeave:Connect(function()
        if not self.Value then Tween(btn, {BackgroundColor3 = Theme.Tertiary}) end
    end)
    
    return self
end

--// Slider with Fill Animation
local Slider = setmetatable({}, Element)
Slider.__index = Slider

function Slider.new(parent, text, min, max, default, callback, decimals)
    local self = setmetatable({}, Slider)
    self.Min, self.Max = min or 0, max or 100
    self.Value = default or self.Min
    self.Callback = callback
    self.AllowDecimals = decimals or false
    
    self.Instance = Create("Frame", {
        Parent = parent,
        Size = UDim2.new(1, 0, 0, 55),
        BackgroundTransparency = 1
    })
    
    local label = Create("TextLabel", {
        Parent = self.Instance,
        Size = UDim2.new(1, -60, 0, 20),
        BackgroundTransparency = 1,
        Text = text,
        TextColor3 = Theme.Text,
        Font = Theme.Font,
        TextSize = Theme.FontSize,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local valueBox = Create("TextBox", {
        Parent = self.Instance,
        Position = UDim2.new(1, -55, 0, 0),
        Size = UDim2.new(0, 55, 0, 24),
        BackgroundColor3 = Theme.Tertiary,
        Text = tostring(self.Value),
        TextColor3 = Theme.Primary,
        Font = Theme.Font,
        TextSize = 12
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 4), Parent = valueBox})
    
    local track = Create("Frame", {
        Parent = self.Instance,
        Position = UDim2.new(0, 0, 0, 35),
        Size = UDim2.new(1, 0, 0, 8),
        BackgroundColor3 = Theme.Tertiary,
        BorderSizePixel = 0
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = track})
    
    local fill = Create("Frame", {
        Parent = track,
        Size = UDim2.new(0, 0, 1, 0),
        BackgroundColor3 = Theme.Primary,
        BorderSizePixel = 0
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = fill})
    
    -- Fixed gradient here too
    local fillGradient = Create("UIGradient", {
        Parent = fill,
        Color = ColorSequence.new(Theme.Primary, Theme.SecondaryColor),
        Transparency = NumberSequence.new(0, 0.2)
    })
    
    local knob = Create("Frame", {
        Parent = track,
        Position = UDim2.new(0, -8, 0.5, -8),
        Size = UDim2.new(0, 16, 0, 16),
        BackgroundColor3 = Color3.fromRGB(255, 255, 255),
        BorderSizePixel = 0,
        ZIndex = 2
    })
    Create("UICorner", {CornerRadius = UDim.new(1, 0), Parent = knob})
    Create("UIStroke", {Color = Theme.Primary, Thickness = 2, Parent = knob})
    
    function self:Set(val)
        val = math.clamp(val, self.Min, self.Max)
        if not self.AllowDecimals then val = math.floor(val) end
        self.Value = val
        valueBox.Text = tostring(val)
        
        local percent = (val - self.Min) / (self.Max - self.Min)
        Tween(fill, {Size = UDim2.new(percent, 0, 1, 0)})
        Tween(knob, {Position = UDim2.new(percent, -8, 0.5, -8)})
        if callback then callback(val) end
    end
    
    local dragging = false
    local function update(input)
        local pos = math.clamp((input.Position.X - track.AbsolutePosition.X) / track.AbsoluteSize.X, 0, 1)
        local val = self.Min + (pos * (self.Max - self.Min))
        self:Set(val)
    end
    
    knob.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            Tween(knob, {Size = UDim2.new(0, 20, 0, 20), Position = UDim2.new(knob.Position.X.Scale, -10, 0.5, -10)})
        end
    end)
    
    track.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            update(input)
        end
    end)
    
    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            update(input)
        end
    end)
    
    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
            Tween(knob, {Size = UDim2.new(0, 16, 0, 16), Position = UDim2.new(knob.Position.X.Scale, -8, 0.5, -8)})
        end
    end)
    
    valueBox.FocusLost:Connect(function()
        local num = tonumber(valueBox.Text)
        if num then self:Set(num) else valueBox.Text = tostring(self.Value) end
    end)
    
    self:Set(self.Value)
    return self
end

--// Window Class
local Window = {}
Window.__index = Window

function Window.new(title, size, options)
    local self = setmetatable({}, Window)
    options = options or {}
    self.Tabs = {}
    
    self.Gui = Create("ScreenGui", {
        Name = "WindUI_" .. HttpService:GenerateGUID(false),
        Parent = PlayerGui,
        ResetOnSpawn = false
    })
    
    -- Animated Background
    local bgFrame = Create("Frame", {
        Parent = self.Gui,
        Size = UDim2.new(1, 0, 1, 0),
        BackgroundColor3 = Theme.Background
    })
    
    if options.ParticleBg then
        ParticleSystem:Init(bgFrame)
    else
        GradientSystem:Apply(bgFrame)
    end
    
    -- Main Container
    self.Main = Create("Frame", {
        Parent = self.Gui,
        Position = UDim2.new(0.5, -size.X.Offset/2, 0.5, -size.Y.Offset/2),
        Size = size,
        BackgroundColor3 = Theme.Background,
        BackgroundTransparency = Theme.GlassTransparency,
        BorderSizePixel = 0
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 12), Parent = self.Main})
    
    -- Blur effect
    local blur = Create("ImageLabel", {
        Parent = self.Main,
        Size = UDim2.new(1, 40, 1, 40),
        Position = UDim2.new(0, -20, 0, -20),
        BackgroundTransparency = 1,
        Image = "rbxassetid://6015897843",
        ImageColor3 = Color3.fromRGB(0, 0, 0),
        ImageTransparency = 0.6,
        ScaleType = Enum.ScaleType.Slice,
        SliceCenter = Rect.new(49, 49, 450, 450)
    })
    
    -- Top Bar
    local topBar = Create("Frame", {
        Parent = self.Main,
        Size = UDim2.new(1, 0, 0, 40),
        BackgroundColor3 = Theme.Secondary,
        BorderSizePixel = 0
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 12), Parent = topBar})
    
    local topGradient = Create("Frame", {
        Parent = topBar,
        Position = UDim2.new(0, 0, 1, -2),
        Size = UDim2.new(1, 0, 0, 2),
        BackgroundColor3 = Theme.Primary,
        BorderSizePixel = 0
    })
    
    -- Fixed gradient animation
    local gradAnim = Create("UIGradient", {
        Parent = topGradient,
        Color = ColorSequence.new(Theme.Primary, Theme.SecondaryColor)
    })
    
    spawn(function()
        while topBar and topBar.Parent do
            for i = 0, 1, 0.01 do
                if not topBar or not topBar.Parent then break end
                gradAnim.Transparency = NumberSequence.new(i, 1-i)
                task.wait(0.05)
            end
        end
    end)
    
    local titleLabel = Create("TextLabel", {
        Parent = topBar,
        Position = UDim2.new(0, 16, 0, 0),
        Size = UDim2.new(1, -120, 1, 0),
        BackgroundTransparency = 1,
        Text = title,
        TextColor3 = Theme.Text,
        Font = Enum.Font.GothamBold,
        TextSize = 18,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    -- Control buttons
    local btnHolder = Create("Frame", {
        Parent = topBar,
        Position = UDim2.new(1, -80, 0, 10),
        Size = UDim2.new(0, 70, 0, 20),
        BackgroundTransparency = 1
    })
    
    local minimizeBtn = Create("TextButton", {
        Parent = btnHolder,
        Position = UDim2.new(0, 0, 0, 0),
        Size = UDim2.new(0, 30, 1, 0),
        BackgroundColor3 = Theme.Warning,
        Text = "−",
        TextColor3 = Theme.Text,
        Font = Enum.Font.GothamBold,
        AutoButtonColor = false
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 6), Parent = minimizeBtn})
    
    local closeBtn = Create("TextButton", {
        Parent = btnHolder,
        Position = UDim2.new(0, 36, 0, 0),
        Size = UDim2.new(0, 30, 1, 0),
        BackgroundColor3 = Theme.Error,
        Text = "×",
        TextColor3 = Theme.Text,
        Font = Enum.Font.GothamBold,
        AutoButtonColor = false
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 6), Parent = closeBtn})
    
    -- Sidebar
    self.Sidebar = Create("Frame", {
        Parent = self.Main,
        Position = UDim2.new(0, 10, 0, 50),
        Size = UDim2.new(0, 150, 1, -60),
        BackgroundColor3 = Theme.Secondary,
        BackgroundTransparency = 0.2,
        BorderSizePixel = 0
    })
    Create("UICorner", {CornerRadius = Theme.CornerRadius, Parent = self.Sidebar})
    
    local sidebarLayout = Create("UIListLayout", {
        Parent = self.Sidebar,
        Padding = UDim.new(0, 6),
        SortOrder = Enum.SortOrder.LayoutOrder
    })
    
    Create("UIPadding", {
        Parent = self.Sidebar,
        PaddingTop = UDim.new(0, 10),
        PaddingLeft = UDim.new(0, 8),
        PaddingRight = UDim.new(0, 8)
    })
    
    -- Content Area
    self.ContentArea = Create("Frame", {
        Parent = self.Main,
        Position = UDim2.new(0, 170, 0, 50),
        Size = UDim2.new(1, -180, 1, -60),
        BackgroundColor3 = Theme.Tertiary,
        BackgroundTransparency = 0.3,
        BorderSizePixel = 0
    })
    Create("UICorner", {CornerRadius = Theme.CornerRadius, Parent = self.ContentArea})
    
    MakeDraggable(self.Main, topBar)
    
    local minimized = false
    minimizeBtn.MouseEnter:Connect(function() Tween(minimizeBtn, {BackgroundColor3 = Color3.fromRGB(255, 180, 80)}) end)
    minimizeBtn.MouseLeave:Connect(function() Tween(minimizeBtn, {BackgroundColor3 = Theme.Warning}) end)
    minimizeBtn.MouseButton1Click:Connect(function()
        minimized = not minimized
        Tween(self.Main, {Size = minimized and UDim2.new(0, size.X.Offset, 0, 40) or size}, Theme.SpringSpeed)
        self.Sidebar.Visible = not minimized
        self.ContentArea.Visible = not minimized
    end)
    
    closeBtn.MouseEnter:Connect(function() Tween(closeBtn, {BackgroundColor3 = Color3.fromRGB(255, 100, 100)}) end)
    closeBtn.MouseLeave:Connect(function() Tween(closeBtn, {BackgroundColor3 = Theme.Error}) end)
    closeBtn.MouseButton1Click:Connect(function()
        Tween(self.Main, {Size = UDim2.new(0, 0, 0, 0), Position = UDim2.new(0.5, 0, 0.5, 0)}, Theme.AnimationSpeed, function()
            self.Gui:Destroy()
        end)
    end)
    
    return self
end

function Window:AddTab(name, icon)
    local tabBtn = Create("TextButton", {
        Parent = self.Sidebar,
        Size = UDim2.new(1, 0, 0, 36),
        BackgroundColor3 = Theme.Tertiary,
        Text = icon and "  " .. icon .. "  " .. name or name,
        TextColor3 = Theme.TextDark,
        Font = Theme.Font,
        TextSize = 14,
        AutoButtonColor = false
    })
    Create("UICorner", {CornerRadius = Theme.CornerRadius, Parent = tabBtn})
    
    local content = Create("ScrollingFrame", {
        Parent = self.ContentArea,
        Size = UDim2.new(1, -20, 1, -20),
        Position = UDim2.new(0, 10, 0, 10),
        BackgroundTransparency = 1,
        ScrollBarThickness = 3,
        ScrollBarImageColor3 = Theme.Primary,
        Visible = false
    })
    
    local layout = Create("UIListLayout", {
        Parent = content,
        Padding = UDim.new(0, 10),
        SortOrder = Enum.SortOrder.LayoutOrder
    })
    
    layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        content.CanvasSize = UDim2.new(0, 0, 0, layout.AbsoluteContentSize.Y + 20)
    end)
    
    local tabObj = {Button = tabBtn, Content = content, Name = name}
    table.insert(self.Tabs, tabObj)
    
    tabBtn.MouseButton1Click:Connect(function() self:SwitchTab(tabObj) end)
    
    if #self.Tabs == 1 then self:SwitchTab(tabObj) end
    return tabObj
end

function Window:SwitchTab(tab)
    if self.ActiveTab == tab then return end
    
    if self.ActiveTab then
        Tween(self.ActiveTab.Button, {BackgroundColor3 = Theme.Tertiary, TextColor3 = Theme.TextDark})
        self.ActiveTab.Content.Visible = false
    end
    
    self.ActiveTab = tab
    Tween(tab.Button, {BackgroundColor3 = Theme.Primary, TextColor3 = Color3.fromRGB(255,255,255)})
    tab.Content.Visible = true
    tab.Content.Position = UDim2.new(0, 20, 0, 10)
    Tween(tab.Content, {Position = UDim2.new(0, 10, 0, 10)})
end

function Window:AddSection(tab, text)
    local section = Create("TextLabel", {
        Parent = tab.Content,
        Size = UDim2.new(1, 0, 0, 26),
        BackgroundTransparency = 1,
        Text = text,
        TextColor3 = Theme.Primary,
        Font = Enum.Font.GothamBold,
        TextSize = 13,
        TextXAlignment = Enum.TextXAlignment.Left
    })
    
    local line = Create("Frame", {
        Parent = section,
        Position = UDim2.new(0, 0, 1, -2),
        Size = UDim2.new(0.3, 0, 0, 2),
        BackgroundColor3 = Theme.Primary,
        BorderSizePixel = 0
    })
    Create("UICorner", {CornerRadius = UDim.new(0, 1), Parent = line})
    
    return section
end

--// Public API
function UILibrary:CreateWindow(title, size, options)
    local win = Window.new(title, size or UDim2.new(0, 700, 0, 500), options)
    
    local originalAddTab = win.AddTab
    win.AddTab = function(self, name, icon)
        local tab = originalAddTab(self, name, icon)
        
        -- Add methods to tab
        tab.AddSection = function(self, text) return Window:AddSection(tab, text) end
        tab.AddButton = function(self, text, cb) return Button.new(tab.Content, text, cb) end
        tab.AddToggle = function(self, text, def, cb) return Toggle.new(tab.Content, text, def, cb) end
        tab.AddSlider = function(self, text, min, max, def, cb, dec) return Slider.new(tab.Content, text, min, max, def, cb, dec) end
        
        return tab
    end
    
    return win
end

function UILibrary:Notify(title, message, type, duration)
    NotificationSystem:Notify(title, message, type, duration)
end

--// Example Usage (commented out)
--[[
local Win = UILibrary:CreateWindow("✨ Enhanced UI", UDim2.new(0, 700, 0, 500), {ParticleBg = true})
local Combat = Win:AddTab("Combat", "⚔️")
Combat:AddSection("Main Features")
Combat:AddToggle("Enable ESP", false, function(v) print(v) end):AddTooltip("See enemies through walls")
Combat:AddSlider("FOV Size", 0, 360, 90, function(v) print(v) end)
UILibrary:Notify("Welcome", "Library loaded successfully!", "Success", 3)
]]

return UILibrary
